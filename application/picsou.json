{
    "title": "PICSOU en action",
    "desc": "Analyse les cours de la bourse et propose des ordres d'achat et de vente de valeurs",
    "menu_orientation": "horizontal",
    "icon_file": "picsou.jpg",
    "basename": "~/data/picsou/picsou.sqlite",
    "basehost": "/mnt/freebox/data/picsou/picsou.sqlite",
    "shell": {
        "Test": "./batch_test.py",
        "Picsou Simul": "./picsou_batch.py -simul",
        "Picsou Quote": "./picsou_batch.py -quote",
        "Picsou Mail Sms": "./picsou_batch.py -quote -simul -mail -sms"
    },
    "tables": {
        "ptf": {
            "key": "ptf_id",
            "elements": {
                "ptf_id": {
                    "label_long": "Valeur",
                    "label_short": "Valeur",
                    "type": "text",
                    "sortable": true,
                    "searchable": true
                },
                "ptf_name": {
                    "label_long": "Nom",
                    "label_short": "Nom",
                    "type": "text",
                    "searchable": true,
                    "sortable": true,
                    "col_width": 140
                },
                "ptf_account": {
                    "label_long": "Compte",
                    "label_short": "CPT",
                    "type": "text",
                    "searchable": true,
                    "sortable": true
                },
                "ptf_quote": {
                    "label_long": "Cours",
                    "label_short": "Cours",
                    "type": "float",
                    "col_align": "right",
                    "display": "%3.2f €",
                    "sortable": true
                },
                "ptf_percent": {
                    "label_long": "Evol",
                    "label_short": "Evol",
                    "type": "float",
                    "col_align": "right",
                    "sql_color": "case when ptf_percent > 0 then '#006600' else '#FF0000' end",
                    "display": "%3.2f %%",
                    "sortable": true
                },
                "ptf_gainj": {
                    "label_long": "Gain du jour",
                    "label_short": "Gain J",
                    "type": "float",
                    "col_align": "right",
                    "sql_color": "case when ptf_gainj > 0 then '#006600' else '#FF0000' end",
                    "display": "%3.2f €",
                    "sortable": true
                },
                "ptf_rsi": {
                    "label_long": "RSI",
                    "label_short": "RSI",
                    "type": "float",
                    "display": "%1.0f",
                    "col_align": "center",
                    "sql_color": "case when ptf_rsi > 67 then '#006600' when ptf_rsi < 37 then '#FF0000' else '#000000' end",
                    "sortable": true
                },
                "ptf_macd": {
                    "label_long": "J26",
                    "label_short": "J26+",
                    "type": "int",
                    "col_align": "right",
                    "sortable": true,
                    "sql_color": "case when ptf_macd > 12 then '#006600' else '#FF0000' end"
                },
                "ptf_e200": {
                    "label_long": "E200",
                    "label_short": "E200",
                    "type": "float",
                    "display": "%3.2f %%",
                    "col_align": "right",
                    "sortable": true,
                    "sql_color": "case when ptf_e200 > 0 then '#006600' else '#FF0000' end"
                },
                "ptf_trade": {
                    "label_long": "Trade",
                    "label_short": "Trade",
                    "type": "text",
                    "searchable": true,
                    "sql_get": "case when ptf_support = 'SSS' then 'SSS' when ptf_resistance = 'RRR' then 'RRR' else '' end"
                },
                "ptf_date": {
                    "label_long": "Date achat",
                    "label_short": "Date achat",
                    "type": "text"
                },
                "ptf_quantity": {
                    "label_long": "Nombre d'actions",
                    "label_short": "Qté",
                    "type": "int",
                    "default": 0,
                    "col_align": "center"
                },
                "ptf_cost": {
                    "label_long": "Coût de revient",
                    "label_short": "Revient",
                    "type": "float",
                    "col_align": "right",
                    "display": "%3.2f €"
                },
                "ptf_gain": {
                    "label_long": "Gain",
                    "label_short": "Gain",
                    "type": "float",
                    "col_align": "right",
                    "display": "%3.2f €",
                    "sql_color": "case when ptf_gain > 0 then '#006600' else '#FF0000' end"
                },
                "ptf_gain_percent": {
                    "label_long": "En %",
                    "label_short": "En %",
                    "type": "float",
                    "col_align": "right",
                    "display": "%3.2f %%",
                    "sql_color": "case when ptf_gain > 0 then '#006600' else '#FF0000' end"
                },
                "ptf_note": {
                    "label_long": "Note",
                    "label_short": "Note",
                    "type": "text",
                    "col_editable": true
                },
                "_fgraph": {
                    "label_long": "Graph",
                    "label_short": "Graph",
                    "type": "form",
                    "params": {
                        "plugin": "picsou_graph.PicsouGraph",
                        "icon_name": "applications-office"
                    }
                },
                "ptf_test_date": {
                    "label_long": "Date",
                    "label_short": "Date Sim.",
                    "type": "text"
                },
                "ptf_test_cost": {
                    "label_long": "Coût de revient",
                    "label_short": "Revient",
                    "type": "float",
                    "col_align": "right",
                    "display": "%3.2f €"
                },
                "ptf_test_quantity": {
                    "label_long": "Quantité",
                    "label_short": "Qté",
                    "type": "int",
                    "default": 0,
                    "col_align": "center"
                },
                "ptf_test_gain": {
                    "label_long": "Gain",
                    "label_short": "Gain",
                    "type": "float",
                    "sortable": true,
                    "col_align": "right",
                    "display": "%3.2f €",
                    "sql_color": "case when ptf_test_gain > 0 then '#006600' else '#FF0000' end"
                },
                "ptf_test_gain_percent": {
                    "label_long": "En %",
                    "label_short": "En %",
                    "type": "float",
                    "col_align": "right",
                    "display": "%3.2f %%",
                    "sql_color": "case when ptf_test_gain > 0 then '#006600' else '#FF0000' end"
                },
                "ptf_test_nbj": {
                    "label_long": "Nombre de jours",
                    "label_short": "Nbj",
                    "type": "int",
                    "default": 0,
                    "sortable": true,
                    "col_align": "center"
                },
                "ptf_test_cumul": {
                    "label_long": "Cumul",
                    "label_short": "Cumul",
                    "type": "float",
                    "col_align": "right",
                    "display": "%3.2f €",
                    "sql_color": "case when ptf_test_cumul > 0 then '#006600' else '#FF0000' end"
                },
                "_batch": {
                    "label_long": "Actualiation des données",
                    "label_short": "Actualiser...",
                    "type": "batch",
                    "params": {
                        "plugin": "picsou_batchui.PicsouBatchUi",
                        "icon_name": "view-refresh",
                        "day": 14,
                        "history": 400,
                        "cash": 10000,
                        "amount": 1200,
                        "cost": 0.005,
                        "cac40_only": false,
                        "label_myptf": "Mes actions le {}",
                        "label_resistance": "Mes actions en r&eacute;sistance (vendre)",
                        "label_support": "Liste des actions en support (achat)",
                        "label_top14": "TOP 14 des actions",
                        "smtp_dest": [
                            "bill.tero@free.fr"
                        ]
                    }
                }
            },
            "views": {
                "vopen": {
                    "title": "Mes Portefeuilles",
                    "form_edit": "fedit",
                    "icon_name": "folder-download",
                    "elements": {
                        "ptf_account": {},
                        "ptf_id": {},
                        "ptf_name": {},
                        "ptf_quote": {},
                        "ptf_percent": {},
                        "ptf_gainj": {},
                        "ptf_rsi": {},
                        "ptf_macd": {},
                        "ptf_e200": {},
                        "ptf_trade": {},
                        "ptf_date": {},
                        "ptf_quantity": {},
                        "ptf_cost": {},
                        "ptf_gain": {},
                        "ptf_gain_percent": {},
                        "ptf_note": {},
                        "_fgraph": {},
                        "_batch": {}
                    },
                    "sql_where": "ptf_account is not null and ptf_account <> ''",
                    "order_by": "ptf_account, ptf_id",
                    "limitX": 1,
                    "sql_footer": "SELECT printf('Le <b>%s</b> Gain du jour: <b>%.2f</b> € Gain: <b>%.2f</b> €', resume_date, resume_gainj, resume_gain) as sql_footer FROM RESUME"
                },
                "vall": {
                    "title": "Les valeurs",
                    "form_add": "fadd",
                    "form_edit": "fedit",
                    "icon_name": "folder",
                    "deletable": true,
                    "searchable": true,
                    "elements": {
                        "ptf_account": {},
                        "ptf_id": {},
                        "ptf_name": {},
                        "ptf_quote": {},
                        "ptf_percent": {},
                        "ptf_rsi": {},
                        "ptf_macd": {},
                        "ptf_e200": {},
                        "ptf_trade": {},
                        "ptf_test_date": {},
                        "ptf_test_quantity": {},
                        "ptf_test_nbj": {},
                        "ptf_test_cost": {},
                        "ptf_test_gain": {},
                        "ptf_test_gain_percent": {},
                        "ptf_note": {},
                        "_fgraph": {}
                    },
                    "sql_whereX": "ptf_id in ('VIE.PA','DSY.PA')",
                    "order_byX": "ptf_id desc"
                },
                "vnote": {
                    "title": "Note",
                    "form_add": "fadd",
                    "form_edit": "fedit",
                    "icon_name": "folder-documents",
                    "elements": {
                        "ptf_account": {},
                        "ptf_id": {},
                        "ptf_name": {},
                        "ptf_quote": {},
                        "ptf_percent": {},
                        "ptf_rsi": {},
                        "ptf_macd": {},
                        "ptf_e200": {},
                        "ptf_trade": {},
                        "ptf_date": {},
                        "ptf_quantity": {},
                        "ptf_cost": {},
                        "ptf_gain": {},
                        "ptf_gain_percent": {},
                        "ptf_note": {},
                        "_fgraph": {}
                    },
                    "sql_where": "ptf_note <> ''"
                },
                "vsimul": {
                    "title": "Simulateur",
                    "form_edit": "fedit",
                    "icon_name": "media-playback-start",
                    "searchable": true,
                    "elements": {
                        "ptf_account": {},
                        "ptf_id": {},
                        "ptf_name": {},
                        "ptf_quote": {},
                        "ptf_percent": {},
                        "ptf_rsi": {},
                        "ptf_macd": {},
                        "ptf_e200": {},
                        "ptf_trade": {},
                        "ptf_test_date": {},
                        "ptf_test_nbj": {},
                        "ptf_test_quantity": {},
                        "ptf_test_cost": {},
                        "ptf_test_gain": {},
                        "ptf_test_gain_percent": {},
                        "ptf_note": {},
                        "_fgraph": {},
                        "_batch": {}
                    },
                    "sql_where": "ptf_intest in ('RRR','SSS','TTT')",
                    "sql_footer": "SELECT resume_simul as sql_footer FROM RESUME"
                }
            },
            "forms": {
                "fadd": {
                    "title": "Ajout d'une valeur",
                    "elements": {
                        "ptf_id": {},
                        "ptf_account": {"hide": true},
                        "ptf_name": {"hide": true},
                        "ptf_quote": {"hide": true},
                        "ptf_rsi": {"hide": true},
                        "ptf_date": {"hide": true},
                        "ptf_macd": {"hide": true}
                    },
                    "sql_post": "update ptf set ptf_macd = ptf_macd where ptf_id = '{ptf_id}'"
                },
                "fedit": {
                    "title": "Mise à jour d'une valeur",
                    "elements": {
                        "ptf_id": {},
                        "ptf_name": {},
                        "ptf_account": {},
                        "ptf_note": {},
                        "ptf_date": {},
                        "ptf_quantity": {},
                        "ptf_cost": {}
                    }
                }
            }
        },
        "cours": {
            "key": "cours_id",
            "elements": {
                "cours_id": {
                    "label_long": "id",
                    "label_short": "id",
                    "type": "int",
                    "hide": true
                },
                "cours_ptf_id": {
                    "label_long": "Valeur",
                    "label_short": "Valeur",
                    "type": "text",
                    "searchable": true
                },
                "cours_name": {
                    "label_long": "Nom",
                    "label_short": "Nom",
                    "type": "text",
                    "searchable": true,
                    "expandable": false,
                    "col_width": 150
                },
                "cours_date": {
                    "label_long": "Date",
                    "label_short": "Date",
                    "type": "text",
                    "sortable": true
                },
                "cours_close": {
                    "label_long": "Cours",
                    "label_short": "Cours",
                    "type": "float",
                    "display": "%3.2f €"
                },
                "cours_high": {
                    "label_long": "Max",
                    "label_short": "Max",
                    "type": "float",
                    "display": "%3.2f €"
                },
                "cours_low": {
                    "label_long": "Min",
                    "label_short": "Min",
                    "type": "float",
                    "display": "%3.2f €"
                },
                "cours_percent": {
                    "label_long": "%",
                    "label_short": "%",
                    "type": "float",
                    "display": "%3.2f %%",
                    "sql_color": "case when cours_percent < 0 then '#FF0000' else '#006600' end"
                },
                "cours_volume": {
                    "label_long": "Volume",
                    "label_short": "Volume",
                    "type": "int"
                },
                "cours_rsi": {
                    "label_long": "RSI",
                    "label_short": "RSI",
                    "type": "int",
                    "sql_color": "case when cours_rsi > 67 then '#006600' when cours_rsi < 37 then '#FF0000' else '#000000' end",
                    "sortable": true
                },
                "cours_trend": {
                    "label_long": "Trend",
                    "label_short": "Trend",
                    "type": "float",
                    "display": "%3.0f %%"
                },
                "cours_trade": {
                    "label_long": "Trade",
                    "label_short": "Trade",
                    "type": "text"
                },
                "cours_nbj": {
                    "label_long": "Nbj",
                    "label_short": "Nbj",
                    "type": "int"
                },
                "cours_gain": {
                    "label_long": "Gain",
                    "label_short": "Gain",
                    "type": "float",
                    "display": "%3.2f €",
                    "sql_color": "case when cours_gain < 0 then '#FF0000' else '#006600' end"
                },
                "cours_inptf": {
                    "label_long": "Ptf",
                    "label_short": "Ptf",
                    "type": "check",
                    "col_editable": true,
                    "jointure": {
                        "join": "LEFT OUTER JOIN mvt ON mvt.mvt_ptf_id = cours.cours_ptf_id AND mvt.mvt_date = cours.cours_date",
                        "display": "case when mvt.mvt_ptf_id is null then '' else '1' end"
                    },
                    "col_sql_update": [
                        "delete from mvt where mvt_ptf_id = '{cours_ptf_id}' and mvt_date = '{cours_date}';",
                        "insert into mvt (mvt_ptf_id, mvt_name, mvt_date, mvt_quote)",
                        "select cours.cours_ptf_id, cours.cours_name, cours.cours_date, cours.cours_close",
                        "from cours left outer join mvt on mvt.mvt_ptf_id = cours.cours_ptf_id and mvt.mvt_date = cours.cours_date",
                        "where mvt.mvt_ptf_id is null and cours.cours_inptf = '1'",
                        "and cours.cours_ptf_id = '{cours_ptf_id}' and cours.cours_date = '{cours_date}';"
                    ]
                }
            },
            "views": {
                "vall": {
                    "title": "Les cours",
                    "searchable_sql": true,
                    "icon_name": "go-jump",
                    "limit": 400,
                    "elements": {
                        "cours_id": {},
                        "cours_ptf_id": {},
                        "cours_name": {},
                        "cours_date": {},
                        "cours_close": {},
                        "cours_percent": {},
                        "cours_rsi": {},
                        "cours_trend": {},
                        "cours_trade": {},
                        "cours_nbj": {},
                        "cours_gain": {},
                        "cours_inptf": {}
                    },
                    "order_by": "cours.cours_ptf_id, cours.cours_date desc"
                }
            },
            "forms": {
            }
        },
        "mvt": {
            "key": "mvt_ptf_id",
            "elements": {
                "mvt_ptf_id": {
                    "label_long": "Valeur",
                    "label_short": "Valeur",
                    "type": "text",
                    "searchable": true
                },
                "mvt_name": {
                    "label_long": "Nom",
                    "label_short": "Nom",
                    "type": "text",
                    "searchable": true,
                    "expandable": false,
                    "col_width": 150
                },
                "mvt_date": {
                    "label_long": "Date",
                    "label_short": "Date",
                    "type": "text",
                    "sortable": true
                },
                "mvt_quote": {
                    "label_long": "Cours",
                    "label_short": "Cours",
                    "type": "float",
                    "display": "%3.2f €"
                },
                "mvt_trade": {
                    "label_long": "Trade",
                    "label_short": "Trade",
                    "type": "text"
                },
                "mvt_cost": {
                    "label_long": "Revient",
                    "label_short": "Revient",
                    "type": "float",
                    "display": "%3.2f €"
                },
                "mvt_quantity": {
                    "label_long": "Quantité",
                    "label_short": "Qté",
                    "type": "int"
                },
                "mvt_charges": {
                    "label_long": "Frais",
                    "label_short": "Frais",
                    "type": "float",
                    "display": "%3.2f €"
                },
                "mvt_gain": {
                    "label_long": "Gain",
                    "label_short": "Gain",
                    "type": "float",
                    "display": "%3.2f €",
                    "sql_color": "case when cours_gain < 0 then '#FF0000' else '#006600' end"
                },
                "mvt_gain_percent": {
                    "label_long": "%",
                    "label_short": "%",
                    "type": "float",
                    "display": "%3.2f %%",
                    "sql_color": "case when mvt_gain_percent < 0 then '#FF0000' else '#006600' end"
                },
                "mvt_note": {
                    "label_long": "Note",
                    "label_short": "Note",
                    "type": "text"
                }
            },
            "views": {
                "vall": {
                    "title": "Historique",
                    "searchable_sql": true,
                    "icon_name": "folder-saved-search",
                    "limit": 400,
                    "elements": {
                        "mvt_ptf_id": {},
                        "mvt_name": {},
                        "mvt_date": {},
                        "mvt_quote": {},
                        "mvt_trade": {},
                        "mvt_cost": {},
                        "mvt_quantity": {},
                        "mvt_charges": {},
                        "mvt_gain": {},
                        "mvt_gain_percent": {},
                        "mvt_note": {}
                    },
                    "order_by": "cours.cours_ptf_id, cours.cours_date desc"
                }
            },
            "forms": {
            }
        }
    }
}